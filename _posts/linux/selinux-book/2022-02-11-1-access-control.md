---
layout:        book
title:         "1. SELinux/アクセス制御の仕組み"
date:          2022-02-11
category:      Linux
cover:         /assets/cover6.jpg
redirect_from:
comments:      true
published:     true
latex:         false
photoswipe:    true
syntaxhighlight: true
sitemap: false # 後で公開すること!
feed:    false # 後で公開すること!
---

**[WIP] この記事は書き途中です。完成までしばらくお待ちください。**

### はじめに

SELinux (Security-Enhanced Linux) は、Linuxのセキュリティ機能を改善するために作られたシステムで、米国国家安全保障局 (NSA) が開発した無料のオープンソースソフトウェアです。
SELinuxは、Red Hat系のLinux (CentOS, RHEL, Fedora) では標準で有効化されていますが、理論的には全てのLinuxにインストールすることが可能です。
SELinuxは、Linuxカーネルモジュールのコードと拡張ファイル属性 (xattr) を使用して、許可されたユーザーとプロセスのみが機密ファイルまたはシステムリソースにアクセスできるようにします。
この仕組みによって、ゼロデイ攻撃などの一般に公開されていない脆弱性を利用したシステムへの攻撃を緩和することができます。

残念ながら、SELinuxは操作が難しいことや情報が少ないことで、多くのシステム管理者が無効化しているのが現状です。
実際、多くの入門書やチュートリアルでは、最初にSELinuxを無効化する手順が含まれています。
しかし、セキュリティの歴史を振り返ってみると、世界には多くの脅威と脆弱性があふれています。
より複雑化したソフトウェア、サードパーティライブラリの使用、増大するネットワーク接続、モバイルコードの使用、ゼロデイの存在 などです。
そして、これらはパッチ管理でパッチを適切に当てていたとしても、システムを保護できない可能性があります。
なぜパッチを当てるだけでは不十分なのか、どのようなセキュリティモデルが情報資産の保護に有効なのか、なぜデフォルトで安全側に設定されて有効化されているのか、などの問いは全てSELinuxにつながっているのです。
この本を通して、SELinuxの仕組みや使い方を説明しますので、SELinuxがすごい仕組みであることを認識してくださると幸いです。


### 情報資産のセキュリティ

情報セキュリティとは、価値の高い情報資産の機密性・完全性・可用性を脅威から保護することです。
情報資産を保護するには、まず資産とは何かを明確に定義するところから始まります。
セキュリティ対策費用の面から全ての資産を守ることはできません。
定量的評価では価値の高い資産から順に、定性的評価では発生可能性と影響を考慮して、優先順位を付けて守ることが重要です。
そして、組織は保護すべき全ての情報資産がどこにあるかを認識し、情報資産を保護するために分類とカテゴリ化をして、適切なセキュリティコントロールを導入します。
つまり、分類とカテゴリ化をしないで情報資産を保護することはできません。

<figure>
<img src="{{ site.baseurl }}/media/book/selinux/1-labeling.png" width=650px />
<figcaption>セキュリティの運用</figcaption>
</figure>

**分類**は、アクセス権を分類する作業のことです。
例えば、情報資産に対して 最高機密 / 機密 / 部外秘 / 非機密 の分類でラベル付けをし、データが侵害されたときの被害の大きさを表します。
**カテゴリ化**は、データの使用に関するセキュリティ要件を満たすために、情報の種類をラベル付けする作業のことです。
例えば、あるデータを「個人情報」にカテゴリ化しておくと、同じレベルの職員でもプロジェクトXに従事している職員は個人情報にアクセスできる、というようなルールやセキュリティ要件を実現することができます。

この分類やカテゴリ化は、データやシステムリソースなどの情報資産だけでなく、人やプロセスなどの情報資産にアクセスするものに対してもラベル付けをすることができます。
政府や軍において人 (職員や隊員) にラベル付けした、アクセスできる機密レベルを「クリアランス」と呼びます。
また、SELinuxではプロセスにラベル付けした、アクセスできるカテゴリのレベルを「ドメイン」と呼びます。

組織は人やプロセスにラベル付けをすることで、その人やプロセスのクリアランスが決まります。
アクセス制御システムは、分類とカテゴリ化が適切に行われると、人やプロセスが情報資産にアクセスできるかを検証できるようになります。
アクセス制御システムは、人やプロセスのクリアランスとその情報を知る必要性を検証した上でアクセスを許可します。
人やプロセスへのラベル付けによって、権限の基本原則である**最小権限** (Least privilege) や、**知る必要性** (Need to know) を実現することができます。

### アクセス制御
アクセス制御は、許可されたユーザとプロセスが、ファイルやシステムリソースにアクセスできるように制御する仕組みのことです。
識別とラベリングが適切にできていれば、アクセス制御を導入することができます。
アクセス制御では、「オブジェクト」と「サブジェクト」と「アクセス」という3つのキーワードが出てきます。

- **オブジェクト**は、情報資産やシステムリソースのことです。例えば、ファイルやメモリ、CPU、ネットワークインターフェースなどは全てオブジェクトです。
- **サブジェクト**は、オブジェクトにアクセスする人やプロセスなどのことです。例えば、パソコンを扱う管理者はサブジェクトですが、DBにアクセスするそのパソコンはサブジェクトになります。つまり、オブジェクトは文脈によってはサブジェクトにもなります。
- **アクション**は、オブジェクトに対する操作のことです。アクセスとも呼びます。

文法的には、サブジェクトは主語、オブジェクトは目的語、アクションは動詞です。
一般的なアクセス制御の概念は、次の図のようになります。

<figure>
<img src="{{ site.baseurl }}/media/book/selinux/1-access-control.png" width=550px />
<figcaption>アクセス制御の概要</figcaption>
</figure>

リファレンスモニタ (参照モニター) は、サブジェクトとオブジェクトの間でセキュリティを強制するコンポーネントです。
リファレンスモニタは、サブジェクトからオブジェクトへのアクセスを監視し、アクセス制御ポリシーに基づいてアクセス許可・拒否を決めます。
このアクセス制御ポリシーには、サブジェクトのラベル、オブジェクトのラベル、アクション の3つの要素から成るルールが複数定義されています。
サブジェクトやオブジェクトへのラベル付けが完了していない環境では、アクセス制御を有効活用することはできないので、分類とカテゴリ化を先に実施する必要があります。
リファレンスモニタがアクセスを拒否した場合、その結果はログに記録されます。アカウンタビリティ (説明責任) のために、許可も拒否も全てログに記録する場合もあります。


### アクセス制御モデル

アクセス制御にはいくつかのモデルがありますが、ここでは SELinux に関連する3つのアクセス制御モデルについて説明します。

- **DAC** : 自分が所有するオブジェクトへのアクセス権を誰に与えるかをオーナーが決定するアクセス制御システムです。
- **MAC** : MACは、アクセス制御ポリシーの決定を中央機関が行うアクセス制御システムです。
- **RBAC** : 職務や認可に応じて個別にロールを設定し、情報システムへのアクセスを許可されたユーザに限定するアクセス制御システムです。

TODO:


---

[NEXT](./2-selinux-intro)
